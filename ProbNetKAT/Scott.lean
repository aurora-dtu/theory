import Mathlib.Topology.Order.ScottTopology
import ProbNetKAT.Cantor

/-!

# Scott

This file defines the Scott-topology and its relation to the Cantor-topology.

## Main definitions

- `ð’ª.scottTopology`: The Scott-topology.
- `ð’ª`: The set of Scott open sets.
- `ð’ª.borel`: The Borel measurable space generated by the Scott-topology.
- `cantor_borel_eq_scott_borel`: Theorem relating the Borel sets generated by the Cantor- and the
  Scott-topologies.

-/

namespace ProbNetKAT

set_option grind.warning false

open Topology MeasureTheory

variable {H : Type}

instance ð’ª.scottTopology : TopologicalSpace (Set H) := Topology.scott _ Set.univ
/-- The Borel measurable space generated by the Scott-topology. -/
def ð’ª.borel : MeasurableSpace (Set H) := @_root_.borel _ ð’ª.scottTopology
/-- The set of Scott-open sets. -/
def ð’ª : Set (Set (Set H)) := ð’ª.scottTopology.IsOpen
instance ð’ª.IsScott : @Topology.IsScott (Set H) Set.univ _ ð’ª.scottTopology := âŸ¨rflâŸ©

/-- The Scott-open sets are a Pi-system, i.e. closed under intersection. -/
theorem ð’ª_IsPiSystem : IsPiSystem (ð’ª (H:=H)) := by
  intro s hs t ht h
  have hâ‚ : IsOpen[ð’ª.scottTopology] s := hs
  have hâ‚‚ : IsOpen[ð’ª.scottTopology] t := ht
  exact IsOpen.inter hâ‚ hâ‚‚

/-- **Lemma 6.** A subset `B âŠ† 2H` is Scott-open iff there exists `F âŠ† â„˜Ï‰(H)` such that
  `B = â‹ƒ a âˆˆ F, B{a}`. -/
theorem ð’ª_mem_iff_finite_cover (B : Set (Set H)) :
    B âˆˆ ð’ª â†” âˆƒ F âŠ† â„˜Ï‰ Set.univ, B = â‹ƒ a âˆˆ F, B{a} := by
  sorry

@[simp]
theorem B_h_is_scott_open {q : H} : B[q] âˆˆ ð’ª := by
  apply (@Topology.IsScott.isOpen_iff_isUpperSet_and_dirSupInaccOn _ Set.univ _ ð’ª.scottTopology
    B[q] inferInstance).mpr
  simp
  constructor
  Â· intro; exact fun â¦ƒbâ¦„ a_1 a â†¦ a_1 a
  Â· exact dirSupInacc_iff_forall_sSup.mpr fun â¦ƒdâ¦„ a a a â†¦ a
@[simp]
theorem B_h_is_scott_measurable : MeasurableSet[ð’ª.borel] B[q] :=
  MeasurableSpace.measurableSet_generateFrom B_h_is_scott_open

/-- Every open set is a countable union of basic open sets `B{a}`, `a âˆˆ â„˜Ï‰(H)`. -/
theorem ahsjkdas (B : Set (Set H)) (hB : B âˆˆ ð’ª) : âˆƒ A âŠ† â„˜Ï‰ Set.univ, B = â‹ƒ a âˆˆ A, B{a} := by
  sorry

/-- The Borel sets of the two topologies (Cantor and Scott) are the same. -/
theorem cantor_borel_eq_scott_borel : â„¬.borel (H:=H) = ð’ª.borel := by
  ext M
  constructor
  Â· intro h
    simp_all [â† â„¬_is_borel]
    induction h with
    | base s hs =>
      induction hs with
      | basic x hx =>
        simp_all
        rcases hx
        Â· rename_i h; obtain âŸ¨q, _, _âŸ© := h
          exact B_h_is_scott_measurable
        Â· rename_i h; obtain âŸ¨q, _, _âŸ© := h
          exact MeasurableSet.compl_iff.mpr B_h_is_scott_measurable
      | univ => simp_all
      | inter => simp_all
      | sUnion => sorry
    | empty => simp
    | compl => simp_all
    | union => simp_all
  Â· intro h
    induction h with
    | basic s hs =>
      simp_all
      replace hs : s âˆˆ ð’ª := hs
      simp_all [ð’ª_mem_iff_finite_cover]
      obtain âŸ¨F, hF, _, _âŸ© := hs
      sorry
    | empty => simp
    | compl => simp_all
    | iUnion S hS ih => exact MeasurableSet.iUnion ih

end ProbNetKAT
